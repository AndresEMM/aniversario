<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Nuestro pequeño arcano</title>

  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@500;700&family=Great+Vibes&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/tsparticles@2.8.0/tsparticles.bundle.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>

  <style>
    :root{
      --bg:#0a0a0f; --fg:#f2e9e4; --accent:#b5179e; --accent2:#4cc9f0; --card:#141423; --gold:#ffd166;
    }
    *{box-sizing:border-box;margin:0;padding:0}
    html,body{height:100%}
    body{
      background: radial-gradient(1200px 800px at 50% 20%, #131325 0%, #0b0b12 60%, var(--bg) 100%);
      color:var(--fg); font-family:"Cinzel", serif; overflow:hidden; user-select:none;
    }

    #tsparticles{position:fixed; inset:0; z-index:-2;}
    .vignette::after{
      content:""; position:fixed; inset:-10%; pointer-events:none;
      background: radial-gradient(60% 60% at 50% 40%, transparent 0%, rgba(0,0,0,.25) 60%, rgba(0,0,0,.6) 100%);
      z-index:-1;
    }
    .moon{
      position:fixed; top:6vh; right:8vw; width:120px; height:120px; border-radius:50%;
      background: radial-gradient(circle at 30% 30%, #fff 0%, #e9ecef 25%, #cfd2d6 40%, #8e99a3 60%, #5a6470 100%);
      box-shadow: 0 0 40px 10px rgba(255,255,255,.08), inset 0 0 40px rgba(255,255,255,.2);
      animation: moonPulse 6s ease-in-out infinite;
    }
    @keyframes moonPulse{0%,100%{transform:translateY(0)}50%{transform:translateY(2px)}}

    header{text-align:center; padding-top:10vh; padding-bottom:2vh;}
    h1{
      font-family:"Great Vibes", cursive; font-size:clamp(2rem, 4vw, 3.5rem);
      color:var(--gold); text-shadow:0 0 10px rgba(255,209,102,.35), 0 0 25px rgba(255,209,102,.2);
    }
    .subtitle{margin-top:.5rem; font-size:clamp(.95rem, 1.8vw, 1.2rem); opacity:.9; color:#e0def4;}

    .altar{display:flex; flex-direction:column; align-items:center; gap:24px; margin-top:3vh;}
    .altar-line{display:flex; gap:22px; justify-content:center; align-items:flex-end;}

    .tarot{width:180px; height:280px; perspective:1000px; filter:drop-shadow(0 10px 25px rgba(0,0,0,.45));}
    .card{position:relative; width:100%; height:100%; transform-style:preserve-3d;
      transition:transform .9s cubic-bezier(.2,.7,.2,1); border-radius:18px;}
    .card.is-flipped{transform:rotateY(180deg)}
    .face{position:absolute; inset:0; backface-visibility:hidden; border-radius:18px; overflow:hidden; border:1px solid rgba(255,255,255,.12);}
    .front{background: radial-gradient(140px 100px at 50% 30%, rgba(255,255,255,.06), transparent 60%), linear-gradient(160deg, #1b1b2b 0%, #121224 100%); display:grid; place-items:center;}
    .front .sigil{width:76%; height:76%; border-radius:50%; border:1px solid rgba(255,255,255,.15); position:relative;
      box-shadow: inset 0 0 40px rgba(178,58,146,.28);
      background: radial-gradient(circle at 50% 50%, rgba(178,58,146,.25), transparent 60%),
                  repeating-conic-gradient(from 0deg, transparent 0deg 20deg, rgba(255,255,255,.08) 20deg 22deg);
      animation:spin 18s linear infinite;}
    .front .sigil::after{content:"🦇"; position:absolute; left:50%; top:50%; transform:translate(-50%,-50%) scale(1.6);
      filter:drop-shadow(0 0 10px rgba(255,255,255,.25));}
    @keyframes spin{to{transform:rotate(360deg)}}

    .back{transform:rotateY(180deg); background: linear-gradient(180deg, #1b1422 0%, #101018 100%);
      padding:12px; display:flex; flex-direction:column; align-items:center; justify-content:flex-start; gap:10px; text-align:center; position:relative;}
    .back::before{content:""; position:absolute; inset:10px; border:1px dashed rgba(255,255,255,.18); border-radius:14px; pointer-events:none;}
    .card-title{color:var(--accent2); letter-spacing:1px; font-weight:700;}
    .image-frame{width:100%; height:70%; border-radius:12px; overflow:hidden; position:relative; background:#0e0e16;}
    .card-img{width:100%; height:100%; object-fit:cover; display:block; filter:contrast(1.05) saturate(1.05);}
    .caption{font-size:.9rem; color:#efeaff; opacity:.95; padding:0 6px;}

    .spell-btn{margin-top:8px; padding:10px 16px; border-radius:999px; border:1px solid rgba(255,255,255,.18);
      background:linear-gradient(180deg, rgba(181,23,158,.22), rgba(181,23,158,.08)); color:#fff; font-weight:600; cursor:pointer; transition:.25s; backdrop-filter: blur(2px);}
    .spell-btn:hover{transform:translateY(-1px); box-shadow:0 6px 18px rgba(181,23,158,.25)}

    .modal{position:fixed; inset:0; display:none; place-items:center; background:rgba(0,0,0,.65); backdrop-filter:blur(4px); z-index:10;}
    .modal.active{display:grid;}
    .modal-card{width:min(92vw, 560px); background: radial-gradient(120% 120% at 30% 0%, rgba(76,201,240,.15), transparent 60%),
      linear-gradient(160deg, #141426 0%, #0f0f18 100%); border:1px solid rgba(255,255,255,.14); border-radius:20px; padding:22px 18px; box-shadow:0 20px 60px rgba(0,0,0,.6); position:relative; overflow:hidden;}
    .modal-card::after{content:""; position:absolute; inset:-20%;
      background: radial-gradient(50% 50% at 70% 0%, rgba(255,209,102,.06), transparent 50%),
                  radial-gradient(60% 60% at 0% 100%, rgba(181,23,158,.08), transparent 60%);}
    .modal h2{font-family:"Great Vibes", cursive; font-size:clamp(1.8rem, 4vw, 2.4rem); color:var(--gold); text-align:center; margin-bottom:12px; text-shadow:0 0 18px rgba(255,209,102,.25);}
    .modal p{font-size:1.05rem; line-height:1.5; text-align:center; color:#efeaff;}
    .close{position:absolute; top:10px; right:14px; font-size:1.6rem; cursor:pointer; color:#fff; opacity:.7; border:none; background:transparent;}
    .close:hover{opacity:1}

    footer{position:fixed; bottom:10px; width:100%; text-align:center; font-size:.85rem; opacity:.7;}

    @media (max-width: 680px){
      .altar-line{gap:14px}
      .tarot{width:140px; height:220px}
    }
  </style>
</head>
<body class="vignette">

  <div id="tsparticles"></div>
  <div class="moon" aria-hidden="true"></div>

  <header>
    <h1>Mi pequeño arcanum para ti</h1>
    <div class="subtitle">Tres cartas, tres visiones… y un hechizo final ✨</div>
  </header>

  <main class="altar">
    <div class="altar-line">
      <div class="tarot" tabindex="0"
           data-theme="Encuentro"
           data-caption="Entre risas y charlas, te volviste mi lugar seguro.">
        <div class="card">
          <div class="face front"><div class="sigil"></div></div>
          <div class="face back">
            <div class="card-title">El Encuentro</div>
            <div class="image-frame"><img class="card-img" alt="Imagen del Encuentro"></div>
            <div class="caption"></div>
          </div>
        </div>
      </div>

      <div class="tarot" tabindex="0"
           data-theme="Presente"
           data-caption="La distancia es solo un mapa; ya aprendimos a navegarlo.">
        <div class="card">
          <div class="face front"><div class="sigil"></div></div>
          <div class="face back">
            <div class="card-title">El Presente</div>
            <div class="image-frame"><img class="card-img" alt="Imagen del Presente"></div>
            <div class="caption"></div>
          </div>
        </div>
      </div>

      <div class="tarot" tabindex="0"
           data-theme="Deseo"
           data-caption="Que cada día nos acerque un poco más.">
        <div class="card">
          <div class="face front"><div class="sigil"></div></div>
          <div class="face back">
            <div class="card-title">El Deseo</div>
            <div class="image-frame"><img class="card-img" alt="Imagen del Deseo"></div>
            <div class="caption"></div>
          </div>
        </div>
      </div>
    </div>

    <button class="spell-btn" id="openSpell">Leer el hechizo final</button>
  </main>

  <div class="modal" id="spellModal" aria-hidden="true">
    <div class="modal-card">
      <button class="close" id="closeSpell" aria-label="Cerrar">✕</button>
      <h2>Hechizo de dos lunas</h2>
      <p id="spellText">
        Bajo esta luna y la tuya, declaro que te quiero y te guardo. Que el camino
        se haga suave, que la distancia sea viento y que, cuando nos miremos,
        todo esto tenga sentido.. y si se presenta el destino.. me ayudes a meterle
        unas buenas patadas, por poner tanta prra distancia >:T.
      </p>
    </div>
  </div>

  <footer>✶ Para ti, desde México hasta Colombia, con un poquito de hacks ;P ✶</footer>

  <script>
    tsParticles.load("tsparticles", {
      fpsLimit: 60,
      background: { color: "transparent" },
      interactivity: {
        events: { onHover: { enable:true, mode:"attract" }, onClick: { enable:true, mode:"push" } },
        modes: { attract: { distance: 160, duration: 0.2, factor: 2 }, push: { quantity: 4 } }
      },
      particles: {
        number: { value: 60 },
        move: { enable: true, speed: 1.2, outModes:{default:"out"} },
        opacity: { value: 0.85 },
        size: { value: { min: 14, max: 22 } },
        shape: { type: "char", character: { value: ["🦇","✨","🌙","🔮"], font:"serif", weight:"400", fill:true }},
        color: { value: ["#ffffff","#ffd166","#b5179e","#4cc9f0"] }
      }
    });

    gsap.from("header h1", { y:-20, opacity:0, duration:1.1, ease:"power2.out" });
    gsap.from(".subtitle", { y:-10, opacity:0, duration:1, delay:.2 });
    gsap.from(".tarot", { y:20, opacity:0, stagger:.12, duration:1.1, ease:"power2.out", delay:.15 });
    gsap.to(".tarot", { y: "+=6", duration:3.5, yoyo:true, repeat:-1, ease:"sine.inOut" });

    const THEMATIC_SOURCES = {
      Encuentro: [
        "https://source.unsplash.com/600x880/?couple,moonlight,night,gothic",
        "https://source.unsplash.com/600x880/?vampire,romance,night,silhouette",
        "https://source.unsplash.com/600x880/?bat,moon,couple,shadows",
        "https://source.unsplash.com/600x880/?tarot,hearts,night"
      ],
      Presente: [
        "https://source.unsplash.com/600x880/?long-distance,phone,stars,night",
        "https://source.unsplash.com/600x880/?map,compass,night,gothic",
        "https://source.unsplash.com/600x880/?letters,chat,love,night",
        "https://source.unsplash.com/600x880/?bridge,stars,distance"
      ],
      Deseo: [
        "https://source.unsplash.com/600x880/?candle,ritual,wish,gothic",
        "https://source.unsplash.com/600x880/?shooting-star,night,dream",
        "https://source.unsplash.com/600x880/?rose,moonlight,gothic",
        "https://source.unsplash.com/600x880/?magic,spell,sparks,night"
      ],
      Default: [
        "https://source.unsplash.com/600x880/?witchcraft,gothic,moon",
        "https://source.unsplash.com/600x880/?tarot,night,magic"
      ]
    };

    function pickRandom(arr){ return arr[Math.floor(Math.random()*arr.length)]; }
    function randomImageUrl(theme){
      const pool = THEMATIC_SOURCES[theme] || THEMATIC_SOURCES.Default;
      return pickRandom(pool) + "&sig=" + Math.random();
    }

    document.querySelectorAll(".tarot").forEach(tarot=>{
      const card = tarot.querySelector(".card");
      const back = card.querySelector(".back");
      const img = back.querySelector(".card-img");
      const caption = back.querySelector(".caption");
      const theme = tarot.dataset.theme;
      const capText = tarot.dataset.caption || "";

      function setRandomBack(){
        const url = randomImageUrl(theme);
        const temp = new Image();
        temp.onload = ()=>{
          img.src = url;
          caption.textContent = capText;
        };
        temp.onerror = ()=>{
          img.src = "data:image/svg+xml;utf8," + encodeURIComponent(
            `<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 600 880'>
               <rect width='100%' height='100%' fill='#0e0e16'/>
               <text x='50%' y='50%' dominant-baseline='middle' text-anchor='middle'
                     fill='#b5179e' font-size='28' font-family='Cinzel'>✨ Magia ✨</text>
             </svg>`
          );
          caption.textContent = capText;
        };
        temp.src = url;
      }

      const flip = ()=>{
        const willShowBack = !card.classList.contains("is-flipped");
        if (willShowBack) setRandomBack();
        card.classList.toggle("is-flipped");
      };

      tarot.addEventListener("click", flip);
      tarot.addEventListener("keypress", e=>{ if(e.key==="Enter" || e.key===" "){ flip(); } });

      tarot.addEventListener("mousemove", e=>{
        const rect = tarot.getBoundingClientRect();
        const x = (e.clientX - rect.left)/rect.width - .5;
        const y = (e.clientY - rect.top)/rect.height - .5;
        gsap.to(card, { rotateY: x*8, rotateX: -y*8, duration:.25, ease:"power2.out" });
      });
      tarot.addEventListener("mouseleave", ()=> gsap.to(card, { rotateY:0, rotateX:0, duration:.35 }));
    });

    const modal = document.getElementById("spellModal");
    const openBtn = document.getElementById("openSpell");
    const closeBtn = document.getElementById("closeSpell");

    openBtn.addEventListener("click", ()=>{
      modal.classList.add("active");
      modal.setAttribute("aria-hidden","false");
      gsap.fromTo("#spellText",{opacity:0, filter:"blur(6px)"},{opacity:1, filter:"blur(0px)", duration:1.1, ease:"power2.out"});
      // “Chispas” simpáticas vía modo push de tsparticles
      setTimeout(()=>emitSparks(), 200);
    });
    closeBtn.addEventListener("click", closeModal);
    modal.addEventListener("click", (e)=>{ if(e.target===modal) closeModal(); });

    function closeModal(){
      gsap.to(".modal-card", { scale:.98, opacity:0.0, duration:.25, ease:"power1.in", onComplete: ()=>{
        modal.classList.remove("active"); modal.setAttribute("aria-hidden","true");
        gsap.set(".modal-card",{ clearProps:"all", opacity:1, scale:1 });
      }});
    }
    function emitSparks(){
      const evt = new MouseEvent("click", { bubbles:true, cancelable:true, view:window });
      document.getElementById("tsparticles").dispatchEvent(evt);
    }
  </script>
</body>
</html>
